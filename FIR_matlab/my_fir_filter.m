fs=10000 %% sampling frequency
f1=500;  %% first sinewave freq (in band)
f2=4500; %% second sinnewave freq (out band)

N=10; %% filter order
nb=9; %% number of bits

T=1/500; %% maximum period
tt=0:1/fs:10*T; %% time samples

x1=sin(2*pi*f1*tt); %% first sinewave
x2=sin(2*pi*f2*tt); %% second sinewave

x=(x1+x2)/2; %% input signal

[bi, bq]=myfir_design(N, nb); %% filter design

y=filter(bq, 1, x); %% apply filter

%% plots
figure
plot(tt,x1,'--d');
hold on
plot(tt,x2,'r--s');
plot(tt,x, 'g--+');
plot(tt, y, 'c--o');

legend('x1', 'x2', 'x', 'y')


%% quantize input and output
xq=floor(x*2^(nb-1));
idx=find(xq==2^(nb-1));
xq(idx)=2^(nb-1)-1;

yq=floor(y*2^(nb-1));
idy=find(yq==2^(nb-1));
yq(idy)=2^(nb-1)-1;

%% save input and output
fp=fopen('samples.txt','w');
fprintf(fp,'%d\n', xq);
fclose(fp);

fp=fopen('resultsm.txt', 'w');
fprintf(fp, '%d\n', yq);
fclose(fp);

y9=[0, -1, -2, -4, 0, 14, 39, 69, 96, 114, 119, 113, 95, 68, 35, -5, -43, -79, -105, -123, -126, -122, -103, -76, -41, -2, 37, 71, 97, 114, 119, 113, 95, 68, 35, -5, -43, -79, -105, -123, -126, -122, -103, -76, -41, -2, 37, 71, 97, 115, 120, 114, 96, 70, 36, -4, -42, -78, -105, -123, -126, -122, -103, -76, -41, -2, 37, 71, 97, 115, 120, 114, 96, 69, 35, -5, -43, -79, -105, -123, -126, -122, -103, -76, -41, -2, 37, 71, 97, 114, 119, 113, 95, 68, 35, -4, -42, -77, -103, -121, -125, -122, -104, -78, -43, -4, 36, 69, 96, 113, 118, 112, 95, 68, 35, -5, -43, -79, -105, -124, -127, -124, -105, -78, -42, -4, 36, 70, 96, 114, 120, 115, 97, 70, 36, -3, -42, -77, -103, -121, -125, -122, -104, -77, -42, -3, 37, 71, 97, 114, 119, 113, 95, 69, 36, -4, -42, -78, -105, -124, -127, -123, -104, -77, -41, -3, 36, 70, 96, 114, 120, 115, 97, 70, 36, -4, -43, -78, -104, -122, -125, -121, -103, -76, -41, -2, 37, 70, 96, 113, 118, 113, 96, 70, 37, -3, -42, -77, -104, -123,-126];
y8=[0, -2, -2, -6, 0, 10, 38, 66, 94, 108, 116, 106, 90, 62, 30, -10, -46, -84, -108, -126, -130, -124, -104, -78, -42, -4, 34, 68, 94, 108, 116, 106, 90, 62, 30, -10, -46, -84, -108, -126, -130, -124, -104, -78, -42, -4, 34, 68, 94, 110, 118, 108, 92, 66, 32, -8, -44, -82, -108, -126, -130, -124, -104, -78, -42, -4, 34, 68, 94, 110, 118, 108, 92, 64, 30, -10, -46, -84, -108, -126, -130, -124, -104, -78, -42, -4, 34, 68, 94, 108, 116, 106, 90, 62, 30, -8, -44, -80, -104, -122, -128, -124, -106, -82, -46, -8, 32, 64, 92, 106, 114, 104, 90, 62, 30, -10, -46, -84, -108, -128, -132, -128, -108, -82, -44, -8, 32, 66, 92, 108, 118, 110, 94, 66, 32, -6, -44, -80, -104, -122, -128, -124, -106, -80, -44, -6, 34, 68, 94, 108, 116, 106, 90, 64, 32, -8, -44, -82, -108, -128, -132, -126, -106, -80, -42, -6, 32, 66, 92, 108, 118, 110, 94, 66, 32, -8, -46, -82, -106, -124, -128, -122, -104, -78, -42, -4, 34, 66, 92, 106, 114, 106, 92, 66, 34, -6, -44, -80, -106, -126,-130];
y7 =[0, -4, -4, -8, 0, 8, 36, 60, 88, 96, 108, 92, 80, 48, 20, -20, -52, -92, -120, -132, -136, -128, -112, -80, -44, -8, 28, 60, 88, 96, 108, 92, 80, 48, 20, -20, -52, -92, -120, -132, -136, -128, -112, -80, -44, -8, 28, 60, 88, 100, 112, 96, 84, 56, 24, -16, -48, -88, -120, -132, -136, -128, -112, -80, -44, -8, 28, 60, 88, 100, 112, 96, 84, 52, 20, -20, -52, -92, -120, -132, -136, -128, -112, -80, -44, -8, 28, 60, 88, 96, 108, 92, 80, 48, 20, -16, -48, -84, -112, -124, -132, -128, -116, -88, -52, -16, 24, 52, 84, 92, 104, 88, 80, 48, 20, -20, -52, -92, -120, -136, -140, -136, -120, -88, -48, -16, 24, 56, 84, 96, 112, 100, 88, 56, 24, -12, -48, -84, -112, -124, -132, -128, -116, -84, -48, -12, 28, 60, 88, 96, 108, 92, 80, 52, 24, -16, -48, -88, -120, -136, -140, -132, -116, -84, -44, -12, 24, 56, 84, 96, 112, 100, 88, 56, 24, -16, -52, -88, -116, -128, -132, -124, -112, -80, -44, -8, 28, 56, 84, 92, 104, 92, 84, 56, 28, -12, -48, -84, -116, -132,-136];
y6=[0, -8, -8, -16, -8, 0, 24, 48, 72, 72, 80, 64, 56, 24, 0, -40, -64, -112, -128, -144, -136, -136, -112, -88, -48, -16, 16, 48, 72, 72, 80, 64, 56, 24, 0, -40, -64, -112, -128, -144, -136, -136, -112, -88, -48, -16, 16, 48, 72, 80, 88, 72, 64, 40, 8, -32, -56, -104, -128, -144, -136, -136, -112, -88, -48, -16, 16, 48, 72, 80, 88, 72, 64, 32, 0, -40, -64, -112, -128, -144, -136, -136, -112, -88, -48, -16, 16, 48, 72, 72, 80, 64, 56, 24, 0, -32, -56, -96, -112, -128, -128, -136, -120, -104, -64, -32, 8, 32, 64, 64, 72, 56, 56, 24, 0, -40, -64, -112, -128, -152, -144, -152, -128, -104, -56, -32, 8, 40, 64, 72, 88, 80, 72, 40, 8, -24, -56, -96, -112, -128, -128, -136, -120, -96, -56, -24, 16, 48, 72, 72, 80, 64, 56, 32, 8, -32, -56, -104, -128, -152, -144, -144, -120, -96, -48, -24, 8, 40, 64, 72, 88, 80, 72, 40, 8, -32, -64, -104, -120, -136, -128, -128, -112, -88, -48, -16, 16, 40, 64, 64, 72, 64, 64, 40, 16, -24, -56, -96, -120, -144, -136];
y5=[0, -16, -16, -32, -16, -16, 0, 32, 48, 32, 32, 16, 16, -16, -48, -80, -80, -160, -160, -176, -144, -160, -128, -112, -48, -32, -16, 32, 48, 32, 32, 16, 16, -16, -48, -80, -80, -160, -160, -176, -144, -160, -128, -112, -48, -32, -16, 32, 48, 48, 48, 32, 32, 16, -32, -64, -64, -144, -160, -176, -144, -160, -128, -112, -48, -32, -16, 32, 48, 48, 48, 32, 32, 0, -48, -80, -80, -160, -160, -176, -144, -160, -128, -112, -48, -32, -16, 32, 48, 32, 32, 16, 16, -16, -48, -64, -64, -128, -128, -144, -128, -160, -144, -144, -80, -64, -32, 0, 32, 16, 16, 0, 16, -16, -48, -80, -80, -160, -160, -192, -160, -192, -160, -144, -64, -64, -32, 16, 32, 32, 48, 48, 48, 16, -32, -48, -64, -128, -128, -144, -128, -160, -144, -128, -64, -48, -16, 32, 48, 32, 32, 16, 16, 0, -32, -64, -64, -144, -160, -192, -160, -176, -144, -128, -48, -48, -32, 16, 32, 32, 48, 48, 48, 16, -32, -64, -80, -144, -144, -160, -128, -144, -128, -112, -48, -32, -16, 16, 32, 16, 16, 16, 32, 16, -16, -48, -64, -128, -144, -176, -144];
r=thd(y,fs,N)
r9 = thd(y9,fs,N)
r8 = thd(y8,fs,N)
r7 = thd(y7,fs,N)
r6 = thd(y6,fs,N)
r5 = thd(y5,fs,N)
